<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analisador de Exames M√©dicos - IA</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <span class="logo-icon">ü©∫</span>
                <div>
                    <h1>MedAI Analyzer</h1>
                    <p class="subtitle">An√°lise de Exames por Intelig√™ncia Artificial</p>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- Aviso m√©dico -->
        <div class="disclaimer-banner">
            <span class="disclaimer-icon">‚öïÔ∏è</span>
            <p>
                <strong>Aviso M√©dico:</strong> Esta ferramenta √© um auxiliar para profissionais de sa√∫de.
                O resultado gerado por IA <strong>n√£o substitui</strong> o diagn√≥stico de um m√©dico especialista.
                Sempre consulte um profissional qualificado.
            </p>
        </div>

        <!-- Alertas Flash -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        <span>{{ '‚ùå' if category == 'error' else '‚úÖ' }}</span>
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Formul√°rio de upload -->
        <div class="card upload-card">
            <h2>Enviar Exame para An√°lise</h2>
            <p class="card-description">
                Fa√ßa upload da imagem do exame m√©dico. O sistema ir√° buscar imagens de refer√™ncia normais
                e utilizar IA para comparar e gerar um laudo detalhado.
            </p>

            <form action="/analyze" method="POST" enctype="multipart/form-data" id="upload-form">
                <div class="upload-area" id="upload-area">
                    <input
                        type="file"
                        name="exam_image"
                        id="exam_image"
                        accept=".png,.jpg,.jpeg,.webp,.gif"
                        class="file-input"
                        required
                    >
                    <label for="exam_image" class="upload-label">
                        <span class="upload-icon">üì∑</span>
                        <span class="upload-text">Clique para selecionar ou arraste a imagem aqui</span>
                        <span class="upload-hint">PNG, JPG, JPEG, WEBP ‚Äî M√°ximo 20MB</span>
                    </label>
                    <div class="preview-container" id="preview-container" style="display:none;">
                        <img id="image-preview" src="" alt="Preview do exame">
                        <button type="button" class="remove-btn" id="remove-btn">‚úï Remover</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="description">Informa√ß√µes Adicionais (opcional)</label>
                    <textarea
                        name="description"
                        id="description"
                        placeholder="Ex: Resson√¢ncia magn√©tica do joelho direito. Paciente relata dor ao flexionar. Suspeita de les√£o no menisco..."
                        rows="3"
                    ></textarea>
                    <small>Forne√ßa contexto cl√≠nico para uma an√°lise mais precisa.</small>
                </div>

                <button type="submit" class="btn-primary" id="submit-btn">
                    <span class="btn-icon">üî¨</span>
                    Analisar Exame com IA
                </button>
            </form>
        </div>

        <!-- Como funciona -->
        <div class="how-it-works">
            <h2>Como Funciona</h2>
            <div class="steps-grid">
                <div class="step">
                    <div class="step-icon">üì§</div>
                    <h3>1. Upload</h3>
                    <p>Envie a imagem do exame m√©dico (Resson√¢ncia, Raio-X, Tomografia, etc.)</p>
                </div>
                <div class="step">
                    <div class="step-icon">üîç</div>
                    <h3>2. Refer√™ncia</h3>
                    <p>O sistema busca automaticamente imagens de refer√™ncia de exames normais para compara√ß√£o</p>
                </div>
                <div class="step">
                    <div class="step-icon">ü§ñ</div>
                    <h3>3. An√°lise IA</h3>
                    <p>O modelo Gemini analisa e compara as imagens, identificando altera√ß√µes e anomalias</p>
                </div>
                <div class="step">
                    <div class="step-icon">üìã</div>
                    <h3>4. Laudo</h3>
                    <p>Receba um laudo estruturado com achados, hip√≥teses diagn√≥sticas e recomenda√ß√µes</p>
                </div>
            </div>
        </div>

        <!-- Tipos de exame suportados -->
        <div class="card supported-exams">
            <h2>Tipos de Exame Suportados</h2>
            <div class="exam-tags">
                <span class="tag">Resson√¢ncia Magn√©tica (RM)</span>
                <span class="tag">Raio-X</span>
                <span class="tag">Tomografia Computadorizada (TC)</span>
                <span class="tag">Ultrassonografia</span>
                <span class="tag">Mamografia</span>
                <span class="tag">PET Scan</span>
            </div>
        </div>
    </main>

    <footer>
        <p>MedAI Analyzer ‚Äî Powered by Google Gemini AI</p>
        <p class="footer-warning">Uso exclusivo como ferramenta de apoio. N√£o substitui avalia√ß√£o m√©dica.</p>
    </footer>

    <div class="loading-overlay" id="loading-overlay" style="display:none;">
        <div class="loading-content">
            <div class="spinner"></div>
            <h3>Analisando exame...</h3>
            <p>Buscando imagens de refer√™ncia e gerando laudo com IA.</p>
            <p>Isso pode levar alguns segundos.</p>
        </div>
    </div>

    <script>
        const fileInput = document.getElementById('exam_image');
        const uploadArea = document.getElementById('upload-area');
        const previewContainer = document.getElementById('preview-container');
        const imagePreview = document.getElementById('image-preview');
        const removeBtn = document.getElementById('remove-btn');
        const form = document.getElementById('upload-form');
        const loadingOverlay = document.getElementById('loading-overlay');
        const uploadLabel = uploadArea.querySelector('.upload-label');

        fileInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    previewContainer.style.display = 'flex';
                    uploadLabel.style.display = 'none';
                };
                reader.readAsDataURL(this.files[0]);
            }
        });

        removeBtn.addEventListener('click', function() {
            fileInput.value = '';
            previewContainer.style.display = 'none';
            uploadLabel.style.display = 'flex';
            imagePreview.src = '';
        });

        // Drag and drop
        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('drag-over');
        });

        uploadArea.addEventListener('dragleave', function() {
            this.classList.remove('drag-over');
        });

        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('drag-over');
            const file = e.dataTransfer.files[0];
            if (file) {
                const dt = new DataTransfer();
                dt.items.add(file);
                fileInput.files = dt.files;
                fileInput.dispatchEvent(new Event('change'));
            }
        });

        form.addEventListener('submit', function() {
            loadingOverlay.style.display = 'flex';
        });
    </script>
</body>
</html>
